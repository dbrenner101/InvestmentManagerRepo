<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd">
<properties>
    <entry key="holdingsAccountInvestmentByInvestmentId">
        <![CDATA[
            SELECT h.holding_id, h.quantity, h.purchase_price, i.investment_id, i.symbol, i.company_name, a.account_id, a.account_name, a.company, a.account_owner
			FROM holdings h, investments i, accounts a
			WHERE 
				h.investment_id = i.investment_id
			    AND h.account_id = a.account_id
				AND i.investment_id = ?
			    AND h.quantity > 0;
        ]]>
    </entry>
    <entry key="allHoldingsByTypeAndSector">
        <![CDATA[
            SELECT SUM(h.purchase_price * h.quantity) as value_at_purchase, i.investment_type, i.sector
			FROM holdings h, investments i
			WHERE h.quantity > 0 and h.investment_id = i.investment_id 
			GROUP BY i.investment_type, i.sector
			ORDER BY i.investment_type;
        ]]>
    </entry>
    <entry key="deleteHolding">
        <![CDATA[
            DELETE
            FROM holdings h
            WHERE holding_id = ?;
        ]]>
    </entry>
    <entry key="allHoldings">
        <![CDATA[
            SELECT h.*, a.*, i.* 
			FROM holdings h
			LEFT JOIN accounts a ON a.account_id = h.account_id
			LEFT JOIN investments i on i.investment_id = h.investment_id;
        ]]>
    </entry>
    <entry key="holdingById">
        <![CDATA[
            SELECT h.*, a.*, i.* 
            FROM holdings h
            LEFT JOIN accounts a ON a.account_id = h.account_id
            LEFT JOIN investments i on i.investment_id = h.investment_id
            WHERE h.holding_id = ?
        ]]>
    </entry>
    <entry key="allHoldingsByMarketValue">
        <![CDATA[
            SELECT SUM(h.purchase_price * h.quantity) as value_at_purchase, i.symbol, i.investment_id, 
                i.company_name, q.price_at_close, SUM(h.quantity * q.price_at_close) as market_value, 
                SUM((h.quantity * q.price_at_close) - (h.purchase_price * h.quantity)) as change_in_value
            FROM holdings h
            LEFT JOIN investments i on i.investment_id = h.investment_id
            LEFT OUTER JOIN quotes q on q.investment_id = i.investment_id and q.quote_date = (
                SELECT MAX(quote_date) FROM quotes
            )
            WHERE h.quantity > 0
            GROUP BY h.purchase_price, h.quantity, i.symbol, i.company_name, q.price_at_close, i.investment_id 
            ORDER BY market_value ?;
        ]]>
    </entry>
    <entry key="allHoldingsByChangeInValue">
        <![CDATA[
            SELECT SUM(h.purchase_price * h.quantity) as value_at_purchase, i.symbol, i.investment_id, 
                i.company_name, q.price_at_close, SUM(h.quantity * q.price_at_close) as market_value, 
                SUM((h.quantity * q.price_at_close) - (h.purchase_price * h.quantity)) as change_in_value 
            FROM holdings h 
            LEFT JOIN investments i on i.investment_id = h.investment_id 
            LEFT OUTER JOIN quotes q on q.investment_id = i.investment_id and q.quote_date = (
                SELECT MAX(quote_date) FROM quotes
            )
            WHERE h.quantity > 0 
            GROUP BY h.purchase_price, h.quantity, i.symbol, i.company_name, q.price_at_close, i.investment_id 
            ORDER BY change_in_value ?;
        ]]>
    </entry>
    <entry key="holdingsByAccountIdAndInvestmentId">
        <![CDATA[
            SELECT h.*, a.*, i.* 
            FROM holdings h, accounts a, investments i
            WHERE h.account_id = ? and h.investment_id = ?;
        ]]>
    </entry>
    <entry key="holdingsByAccountId">
        <![CDATA[
            SELECT h.*, a.*, i.* 
            FROM holdings h, accounts a, investments i
            WHERE h.account_id = ? and h.investment_id = i.investment_id;
        ]]>
    </entry>
    <entry key="holdingsByAccountIdWithQuantityGreater0OrderSymbol">
        <![CDATA[
            SELECT h.*, a.*, t.*, i.*, q.*
            FROM holdings h, accounts a, transactions t, investments i, quotes q
            WHERE 
            	h.account_id = a.account_id 
            	AND t.holding_id = h.holding_id 
            	AND i.investment_id = h.investment_id
                AND q.investment_id = i.investment_id
                AND q.quote_date = (SELECT MAX(quote_date) FROM quotes)
                AND t.transaction_type in ('Buy','Transfer') 
                AND h.account_id = ? 
                AND h.quantity > 0;
        ]]>
    </entry>
    <entry key="allHoldingsOrderedBySymbol">
        <![CDATA[
            SELECT h.*, i.*, a.*
            FROM holdings h, investments i, accounts a
            WHERE h.investment_id = i.investment_id AND h.account_id = a.account_id
            ORDER BY i.symbol;
        ]]>
    </entry>
    <entry key="holdingsInsert">
        <![CDATA[
            INSERT INTO holdings(purchase_price, quantity, account_id, investment_id)
            VALUES(?, ?, ?, ?);
        ]]>
    </entry>
    <entry key="holdingUpdate">
        <![CDATA[
            UPDATE holdings
            SET 
                purchase_price = ?,
                quantity = ?, 
                account_id = ?,  
                investment_id = ?
            WHERE holding_id = ?
        ]]>
    </entry>
</properties>